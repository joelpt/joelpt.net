// Show an "Warning: This is an external link to <hostname>" message to the user when they are trying to visit a host other than *.amazon.com.
require(['jquery','bootstrap'], function ($) {
    $('a[href]').each(function() {
        var currentLinkElement = $(this);
        var url = currentLinkElement.attr("href");
        if (!isValidUrl(url)) {
            return;
        }
        // Make sure relative urls have the correct hosts
        const host = currentLinkElement[0].hostname;
        if (!isAmazonHost(host)) {
            currentLinkElement.attr({'data-toggle': 'tooltip', 'data-placement': 'top', 'title': "Warning: This is an external link to " + host});
        }
    });
    $('[data-toggle="tooltip"]').tooltip();


    function isValidUrl(url) {
       /*
        * Here is where I get the regex from
        * https://tools.ietf.org/html/rfc3986#appendix-B
        * and limit the URL schemes
        */
        return /^(https?|ftp):(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/i.test(url);
    }

    function isAmazonHost(host) {
        var amazonHostRegex = /\.amazon\.com$/i;
        return amazonHostRegex.test(host);
    }
});

